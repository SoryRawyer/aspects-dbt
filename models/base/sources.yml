version: 2

sources:
  - name: xapi
    database: "{{ env_var('ASPECTS_XAPI_DATABASE', 'xapi') }}"
    description: "the xapi database in clickhouse"
    tables:
      - name: xapi_events_all
        identifier: "{{ env_var('ASPECTS_VECTOR_RAW_XAPI_TABLE', 'xapi_events_all') }}"
        description: "Base table for raw xAPI events"
        columns:
          - name: event_id
          - name: emission_time
          - name: event

  - name: event_sink
    database: "{{ env_var('ASPECTS_EVENT_SINK_DATABASE', 'event_sink')}}"
    tables:
      - name: course_block_names
        columns:
          - name: location
          - name: block_name
          - name: course_key
          - name: graded
          - name: display_name_with_location

      - name: course_names
        columns:
          - name: course_key
          - name: course_name
          - name: course_run
          - name: org

      - name: user_pii
        columns:
          - name: user_id
            description: "The user id"
          - name: external_user_id
            description: "The external user id"
          - name: external_id_type
            description: "The external id type"
          - name: username
            description: "The username"
          - name: name
            description: "The name of the user"
          - name: meta
            description: "A field to store custom information as JSON"
          - name: courseware
            description: "Unknown"
          - name: language
            description: "The language of the user"
          - name: location
            description: "Unknown"
          - name: year_of_birth
            description: "The year of birth of the user"
          - name: gender
            description: "The gender of the user"
          - name: level_of_education
            description: "The level of education of the user"
          - name: mailing_address
            description: "The mailing address of the user"
          - name: city
            description: "The city of the user"
          - name: country
            description: "The country of the user"
          - name: state
            description: "The state of the user"
          - name: goals
            description: "The goals of the user"
          - name: bio
            description: "The bio of the user"
          - name: profile_image_uploaded_at
            description: "Date of the profile image upload"
          - name: phone_number
            description: "The phone number of the user"

      - name: course_blocks
        columns:
          - name: org
            data_type: string
          - name: course_key
            data_type: string
          - name: location
            data_type: string
          - name: display_name
            data_type: string
          - name: xblock_data_json
            data_type: string
          - name: order
            data_type: int32
          - name: edited_on
            data_type: string
          - name: dump_id
            data_type: uuid
          - name: time_last_dumped
            data_type: string

      - name: course_overviews
        columns:
          - name: org
            data_type: string
          - name: course_key
            data_type: string
          - name: display_name
            data_type: string
          - name: course_start
            data_type: string
          - name: course_end
            data_type: string
          - name: enrollment_start
            data_type: string
          - name: enrollment_end
            data_type: string
          - name: self_paced
            data_type: bool
          - name: course_data_json
            data_type: string
          - name: created
            data_type: string
          - name: modified
            data_type: string
          - name: dump_id
            data_type: uuid
          - name: time_last_dumped
            data_type: string

      - name: user_profile
        columns:
          - name: id
            data_type: int32
          - name: user_id
            data_type: int32
          - name: name
            data_type: string
          - name: email
            data_type: string
          - name: meta
            data_type: string
          - name: courseware
            data_type: string
          - name: language
            data_type: string
          - name: location
            data_type: string
          - name: year_of_birth
            data_type: string
          - name: gender
            data_type: string
          - name: level_of_education
            data_type: string
          - name: mailing_address
            data_type: string
          - name: city
            data_type: string
          - name: country
            data_type: string
          - name: state
            data_type: string
          - name: goals
            data_type: string
          - name: bio
            data_type: string
          - name: profile_image_uploaded_at
            data_type: string
          - name: phone_number
            data_type: string
          - name: dump_id
            data_type: uuid
          - name: time_last_dumped
            data_type: string

      - name: external_id
        columns:
          - name: external_user_id
            data_type: uuid
          - name: external_id_type
            data_type: string
          - name: username
            data_type: string
          - name: user_id
            data_type: int32
          - name: dump_id
            data_type: uuid
          - name: time_last_dumped
            data_type: string
